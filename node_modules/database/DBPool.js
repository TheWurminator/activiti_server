//Instantiates database connection
this.mysql = require("mysql"); 
this.dbinfo = require('./connection.json'); //Authentication information for database
this.pool = this.mysql.createPool(this.dbinfo); //Create db connection pool 

//Function to execute query in database
exports.sendQuery = function(queryString, cb) {
	//Obtain a free connection to the database
	var globPool = this.pool;
	this.pool.getConnection(function(err, connection) {
		//Submit query to database
		if(err){
			console.log("Cannot connect to db");
			cb(null);
		}
		var query = globPool.query(queryString, function(err, results, rows) {		
			//Check query results for an error
			if(err){
				//Log error to console
				//Send error response to cb function
				console.log("error is " + err);
				connection.release();
				cb(null);
			}
			else{
				//Send query results back up through cb function
				connection.release();
				cb(results);
			}
			//Free db connection to service queued queries
		});
	});
}

//Close all connections to database
exports.endConnection = function(){
	this.pool.end(function (err) {
		//Connections are closed
		//Check for errors
		if(err) {
			console.log(err);
		}
	});
}
